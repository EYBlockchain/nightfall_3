version: '3.5'
# Use this script for running up nightfall_3 with images
# If you replace the main docker-compose with this file, it should work!
services:
  # Temporary container to deploy contracts and circuits and populate volumes
  deployer:
    image: ghcr.io/eyblockchain/nightfall3-deployer
    volumes:
      - type: volume
        source: build
        target: /app/build/
    networks:
      - nightfall_network
    environment:
      LOG_LEVEL: debug
      # ETH_NETWORK sets the network selected by Truffle from truffle-config.js
      # startup routines will wait for a blockchain client to be reachable on this network
      ETH_NETWORK: blockchain1
      BLOCKCHAIN_WS_HOST: blockchain1
      BLOCKCHAIN_PORT: 8546
      ZOKRATES_WORKER_HOST: worker
      # TIMBER_HOST: timber1
      # TIMBER_PORT: 80
      USE_STUBS: 'false'

  worker:
    image: ghcr.io/eyblockchain/nightfall3-worker
    volumes:
      - type: volume
        source: ./proving_files
        target: /app/output/
    depends_on:
      - deployer
    networks:
      - nightfall_network
    environment:
      LOG_LEVEL: info

volumes:
  proving_files:
  build:

networks:
  nightfall_network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.238.0/24
          gateway: 172.16.238.1
