import path from 'path';
import circomTester from 'circom_tester';
import { fileURLToPath } from 'url';
// import { generalise } from 'general-number';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const tester = circomTester.wasm;
// const { expect } = chai;

describe('Test tokenise circuit', function () {
  this.timeout(60000);
  const circuitPath = path.join(__dirname, '../../../nightfall-deployer/circuits/transform.circom');
  let circuit;
  let witnessInput;

  before(async () => {
    circuit = await tester(circuitPath, { reduceConstraints: false });
    await circuit.loadConstraints();
    console.log(`Constraints: ${circuit.constraints.length}\n`);

    witnessInput = {
      value: '0',
      fee: '1',
      circuitHash: '970687214273',
      tokenType: '0',
      historicRootBlockNumberL2: ['1', '1', '0', '0', '0', '0'],
      ercAddress: '0',
      tokenId: ['0', '0', '0', '0', '0', '0', '0', '0'],
      recipientAddress: '0',
      commitments: [
        '20900694524881696856703008484688595491691239167061225803152247307701907006114',
        '17790436739052110264051014611673556496490794548578201299272398354558786632041',
        '1571673415945846824901115427500106081256037894563845834269773309382345471923',
        '0',
        '0',
      ],
      nullifiers: [
        '6981353681810573769082672385222297789541465313724905360954972794338508954523',
        '18475616009371650421540758179769425063867144107128459962007896567414102153151',
        '0',
        '0',
        '0',
        '0',
      ],
      compressedSecrets: ['0', '0'],
      roots: [
        '17823409039182688543767331952669770167691311679437116467054097129152742120183',
        '17823409039182688543767331952669770167691311679437116467054097129152742120183',
        '0',
        '0',
        '0',
        '0',
      ],
      feeAddress: '1319533947831612348694315757168650042041713553662',
      rootKey: '2279923558995011751611063584918713773156544989985830828459384641106187332209',
      nullifiersValues: ['5', '9', '0', '0', '0', '0'],
      nullifiersSalts: [
        '13315877029151738869300786250664151350773016096271827983829434422764764950753',
        '9126999108087007603713645707993362614502691852685611693647930809018133850674',
        '0',
        '0',
        '0',
        '0',
      ],
      paths: [
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '17775976165114793340295229435972859589480738614721901107324612028249317885662',
          '20554106325615359005862227203305840741252236894913769564859540095001347498426',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '13031782623055536525267266880667405703498589831243514974749002762277199440885',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
      ],
      orders: ['1', '2', '0', '0', '0', '0'],
      commitmentsValues: ['5', '5', '8', '0', '0'],
      commitmentsSalts: [
        '13315877029151738869300786250664151350773016096271827983829434422764764950753',
        '13315877029151738869300786250664151350773016096271827983829434422764764950753',
        '20734609687383546767900309592007771522611756902126483009302063724608392096804',
        '0',
        '0',
      ],
      recipientPublicKey: [
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        ['0', '0'],
        ['0', '0'],
      ],
      inputPackedAddressesPrivate: [
        '21711016731996786641919559690247483764940821657995939631028283661898381880356',
        '1319533947831612348694315757168650042041713553662',
        '0',
        '0',
        '0',
        '0',
      ],
      inputIdRemaindersPrivate: ['1', '0', '0', '0', '0', '0'],
      outputPackedAddressesPrivate: [
        '21711016731996786641919559690247483764940821657995939631028283661898381880356',
        '21711016731996786641919559690247483764940821657995939631028283661898381880356',
        '1319533947831612348694315757168650042041713553662',
        '0',
        '0',
      ],
      outputIdRemaindersPrivate: ['3', '4', '0', '0', '0'],
    };
  });

  it('should verify a valid transform', async () => {
    const w = await circuit.calculateWitness(witnessInput);
    await circuit.assertOut(w, {});
  });
});
