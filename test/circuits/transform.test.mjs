import path from 'path';
import circomTester from 'circom_tester';
import { fileURLToPath } from 'url';
// import { generalise } from 'general-number';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const tester = circomTester.wasm;
// const { expect } = chai;

describe('Test tokenise circuit', function () {
  this.timeout(60000);
  const circuitPath = path.join(__dirname, '../../nightfall-deployer/circuits/transform.circom');
  let circuit;
  let witnessInput;

  before(async () => {
    circuit = await tester(circuitPath, { reduceConstraints: false });
    await circuit.loadConstraints();
    console.log(`Constraints: ${circuit.constraints.length}\n`);

    witnessInput = {
      value: '0',
      fee: '1',
      circuitHash: '0',
      tokenType: '0',
      historicRootBlockNumberL2: ['8', '10', '12'],
      ercAddress: '0',
      tokenId: ['0', '0', '0', '0', '0', '0', '0', '0'],
      recipientAddress: '0',
      commitments: [
        '19268988550418773170238623582961124249916592293004422600822207516961907057151',
        '10751078579315761192882408566052269695133278356890925069287933140840340577562',
        '7490493712751988064236386951826325655061970526087674440736199396382621921563',
        '2529660626007516207344238372205504747728763178777782608795019436881967110560',
      ],
      nullifiers: [
        '20078516206569025944876928229814773698062086640852004994947833354879373450909',
        '12520256811353307060554885374843834290392920423941166491846531201942710724616',
        '1138431790066774697630421631104350660643800776041407955451756989136976588705',
      ],
      compressedSecrets: ['0', '0'],
      roots: [
        '19159497913267991494510824192526243977655140629324946121657007007847130611389',
        '2099129870491650230841819836341525161623741679339371735797291756767835797987',
        '21497166518643310077679242598942337683675305561912378732029006577454669375161',
      ],
      feeAddress: '1319533947831612348694315757168650042041713553662',
      rootKey: '2279923558995011751611063584918713773156544989985830828459384641106187332209',
      nullifiersValues: ['10', '10', '10'],
      nullifiersSalts: [
        '11710164417752465301813830524566786710525797839279890528284612429875709095551',
        '7620215500883301548349305409270218553208227019348401663495104084603705455615',
        '12306431601118932799506851193182525884952813226644628352921187251440321521502',
      ],
      paths: [
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '16097513192599476503903657114268687723289321431169080741724070304392815551413',
          '0',
          '0',
          '5216058080544280403825030132190017281329313119309546590822707429365906185953',
          '14251205984402012982779653250435593081188824800916458016005199048689858991012',
          '8846554379461620830650250312833637819246828201480132549772161157603288516349',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '16097513192599476503903657114268687723289321431169080741724070304392815551413',
          '0',
          '13319252410129177017842509187864042880034486138873744907002155837882090303863',
          '2543380775216776246400362210549196191860084901796610568589600299144599513977',
          '18981883231236029413917482980574653313532344992619555433460674910747355845442',
          '10544271495134932123880766477671942447788024972620404052862718254132954177687',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '16097513192599476503903657114268687723289321431169080741724070304392815551413',
          '0',
          '0',
          '0',
          '14251205984402012982779653250435593081188824800916458016005199048689858991012',
          '8846554379461620830650250312833637819246828201480132549772161157603288516349',
        ],
      ],
      orders: ['35', '43', '35'],
      commitmentsValues: ['9', '9', '9', '1'],
      commitmentsSalts: [
        '5341400557941999326446453554204858718748528519159440200280223552030198382981',
        '3256082702174305894051487559055554865674558418787579020309088329252202455989',
        '12017589153456462252947957387299788944235342859185857239697559002643474498127',
        '18066887605171563178427876953378472960547306070268842699021232485370624611899',
      ],
      recipientPublicKey: [
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
      ],
      inputPackedAddressesPrivate: [
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
      ],
      inputIdRemaindersPrivate: ['333', '444'],
      inputValuesPrivate: ['1', '1'],
      outputPackedAddressesPrivate: [
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
      ],
      outputIdRemaindersPrivate: ['99'],
      outputValuesPrivate: ['1'],
    };
  });

  it('should verify a valid transform', async () => {
    const w = await circuit.calculateWitness(witnessInput);
    await circuit.assertOut(w, {});
  });
});
