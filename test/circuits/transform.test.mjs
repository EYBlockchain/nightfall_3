import path from 'path';
import circomTester from 'circom_tester';
import { fileURLToPath } from 'url';
// import { generalise } from 'general-number';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const tester = circomTester.wasm;
// const { expect } = chai;

describe('Test tokenise circuit', function () {
  this.timeout(60000);
  const circuitPath = path.join(__dirname, '../../nightfall-deployer/circuits/transform.circom');
  let circuit;
  let witnessInput;

  before(async () => {
    circuit = await tester(circuitPath, { reduceConstraints: false });
    await circuit.loadConstraints();
    console.log(`Constraints: ${circuit.constraints.length}\n`);

    witnessInput = {
      value: '0',
      fee: '1',
      circuitHash: '1052974494608',
      tokenType: '0',
      historicRootBlockNumberL2: ['5', '0', '0', '0', '0', '0'],
      ercAddress: '0',
      tokenId: ['0', '0', '0', '0', '0', '0', '0', '0'],
      recipientAddress: '0',
      commitments: [
        '391339582897719038831728746870187598753074134515754888284191829751743830610',
        '4199042811359080034498544130967695414690659598490040621697212308736624272539',
        '15112978567959970264699364829321262005648550773488131752065797940420383457981',
        '0',
        '0',
      ],
      nullifiers: [
        '16790940465792341356473494681767698388537479535072372808884865380962849188182',
        '0',
        '0',
        '0',
        '0',
        '0',
      ],
      compressedSecrets: ['0', '0'],
      roots: [
        '13396702299412546460395088445244076475114450389359919750033280627784739426302',
        '0',
        '0',
        '0',
        '0',
        '0',
      ],
      feeAddress: '1319533947831612348694315757168650042041713553662',
      rootKey: '2279923558995011751611063584918713773156544989985830828459384641106187332209',
      nullifiersValues: ['9', '0', '0', '0', '0', '0'],
      nullifiersSalts: [
        '15159518050823679024831059885763363186451054938093900880410343035341635922256',
        '0',
        '0',
        '0',
        '0',
        '0',
      ],
      paths: [
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '16875714247841609431522954188359571424709204894742378365014534113819078985041',
          '21607804382906743748151501481205846525930149892878331828857941359129312907063',
          '16931023337272441761683286935749477297218323376397284601972735162865595163057',
          '0',
          '2287824442071276085562347974917630234139809364186838278994356787554321540261',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
      ],
      orders: ['29', '0', '0', '0', '0', '0'],
      commitmentsValues: ['8', '1', '1', '0', '0'],
      commitmentsSalts: [
        '1531272055417856694452001510474193147219446457192407117014452689011004347943',
        '912215340802450973627881847705766778613310182375524236928533133087062584757',
        '13204685254203381879503806581424870656373278912283911854636033988199831743798',
        '0',
        '0',
      ],
      recipientPublicKey: [
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        ['0', '0'],
        ['0', '0'],
      ],
      inputPackedAddressesPrivate: [
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '0',
        '0',
      ],
      inputIdRemaindersPrivate: ['2', '1', '0', '0'],
      outputPackedAddressesPrivate: [
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '0',
        '0',
      ],
      outputIdRemaindersPrivate: ['4', '3', '0', '0'],
    };
  });

  it('should verify a valid transform', async () => {
    const w = await circuit.calculateWitness(witnessInput);
    await circuit.assertOut(w, {});
  });
});
