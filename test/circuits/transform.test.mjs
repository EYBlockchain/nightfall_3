import path from 'path';
import circomTester from 'circom_tester';
import { fileURLToPath } from 'url';
// import { generalise } from 'general-number';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const tester = circomTester.wasm;
// const { expect } = chai;

describe('Test tokenise circuit', function () {
  this.timeout(60000);
  const circuitPath = path.join(__dirname, '../../nightfall-deployer/circuits/transform.circom');
  let circuit;
  let witnessInput;

  before(async () => {
    circuit = await tester(circuitPath, { reduceConstraints: false });
    await circuit.loadConstraints();
    console.log(`Constraints: ${circuit.constraints.length}\n`);

    witnessInput = {
      value: '0',
      fee: '1',
      circuitHash: '693129176717',
      tokenType: '0',
      historicRootBlockNumberL2: ['1', '2', '0', '0', '0', '0'],
      ercAddress: '0',
      tokenId: ['0', '0', '0', '0', '0', '0', '0', '0'],
      recipientAddress: '0',
      commitments: [
        '4438410233618442933668671822985990508735583017911791551155011744565494935509',
        '9204453341660897227563733261453569337257868427270966902039468196581053956557',
        '17313980710402695309518321074281688679325997129179183317244671703957766514511',
        '0',
        '0',
      ],
      nullifiers: [
        '2845742099578760344075144826965418238243466166862303771654696099029637025224',
        '0',
        '18551221450542471676235516633546774915489003321481446261668331501154600526066',
        '0',
        '0',
        '0',
      ],
      compressedSecrets: ['0', '0'],
      roots: [
        '15188102659694209610426706390166063700081342937707906422024294695237627615980',
        '0',
        '17929555265001097002421760087839629075721990315657495397312481458709948032693',
        '0',
        '0',
        '0',
      ],
      feeAddress: '1319533947831612348694315757168650042041713553662',
      rootKey: '2279923558995011751611063584918713773156544989985830828459384641106187332209',
      nullifiersValues: ['10', '0', '1', '0', '0', '0'],
      nullifiersSalts: [
        '14648842819858642848436445423572146320860110024016943259314793168084201566635',
        '0',
        '15986737853633442249473898411701842178840064731339137866675763870168432196045',
        '0',
        '0',
        '0',
      ],
      paths: [
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '13327110860017320576523889071847113583074756893122223386447763376695144256280',
          '13766974186743779511081233532809406316231543431143333783256843912249423427521',
          '2540914424066102084955353580675586493206616591500880946936588395536511289148',
          '4157990737172480029132215498114138639692395378527632032061779123718711487009',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '13327110860017320576523889071847113583074756893122223386447763376695144256280',
          '8390313384569560722442221984735462731226327544632031080156290211465013674313',
          '12811391549017411512148109799481500645767109452180520705958872101995005548458',
          '13921661290765803837913378595299214433252089002583084187272576934064680700219',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
        ],
      ],
      orders: ['9', '0', '11', '0', '0', '0'],
      commitmentsValues: ['9', '1', '1', '0', '0'],
      commitmentsSalts: [
        '3734607186076438000800401985386087356284158426904691199721505243602174260354',
        '561332848994750860971129362771939132123106669116651497029649131420418738217',
        '3818451844908527458780246324732945948774871260708865924955891191298624039061',
        '0',
        '0',
      ],
      recipientPublicKey: [
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        [
          '8490685904787475746369366901729727151930997402058548597274067437080179631982',
          '16019898780588040648157153023567746553375452631966740349901590026272037097498',
        ],
        ['0', '0'],
        ['0', '0'],
      ],
      inputPackedAddressesPrivate: [
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '0',
        '0',
        '0',
      ],
      inputIdRemaindersPrivate: ['1', '0', '0', '0'],
      outputPackedAddressesPrivate: [
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '21711016731996786641919559689181659195500147010365013840184326362539582930271',
        '0',
        '0',
      ],
      outputIdRemaindersPrivate: ['3', '4', '0', '0'],
    };
  });

  it('should verify a valid transform', async () => {
    const w = await circuit.calculateWitness(witnessInput);
    await circuit.assertOut(w, {});
  });
});
