import React, { useEffect, useState } from 'react';
import { initialize } from 'zokrates-js';

// eslint-disable-next-line
import abi from '../../zokrates/double_transfer/artifacts/double_transfer-abi.json';
// eslint-disable-next-line
import programFile from '../../zokrates/double_transfer/artifacts/double_transfer-program';
// eslint-disable-next-line
import pkFile from '../../zokrates/double_transfer/keypair/double_transfer-pk';
import { parseData, mergeUint8Array } from '../../utils/lib/file-reader-utils';

export default function Zokrates() {
  const [proof, setProof] = useState('');
  useEffect(async () => {
    const zokratesProvider = await initialize();
    const program = await fetch(programFile)
      .then(response => response.body.getReader())
      .then(parseData)
      .then(mergeUint8Array);
    const pk = await fetch(pkFile)
      .then(response => response.body.getReader())
      .then(parseData)
      .then(mergeUint8Array);

    const artifacts = { program: new Uint8Array(program), abi: JSON.stringify(abi) };
    const keypair = { pk: new Uint8Array(pk) };

    const witnessInput = [
      [
        '1372267967327876207394531437215731016851360150467',
        '1372267967327876207394531437215731016851360150467',
      ],
      [
        {
          id: ['0', '0', '0', '0', '0', '0', '0', '0'],
          value: ['0', '0', '0', '0', '0', '0', '2', '1410065408'],
          salt: [
            '3173942554',
            '1948672911',
            '944775691',
            '1958156683',
            '695997230',
            '2794283905',
            '2860188174',
            '2757047456',
          ],
          hash: [
            '401835515',
            '1336682621',
            '1087271281',
            '397742040',
            '1911993899',
            '2537877406',
            '15232588',
            '1485777233',
          ],
          ask: '1754386802144849162438981230569815152797914906841974666919224833145472521851',
        },
        {
          id: ['0', '0', '0', '0', '0', '0', '0', '0'],
          value: ['0', '0', '0', '0', '0', '0', '0', '1000000000'],
          salt: [
            '2246208325',
            '3976581806',
            '924274170',
            '2727116320',
            '103872325',
            '2249727273',
            '2345114714',
            '1098567841',
          ],
          hash: [
            '329181187',
            '1986653492',
            '2200707616',
            '3181396184',
            '469056713',
            '3601877863',
            '2095763966',
            '1916944028',
          ],
          ask: '1754386802144849162438981230569815152797914906841974666919224833145472521851',
        },
      ],
      [
        {
          pkdRecipient: [
            '7558626710895993898073674364114394751322422716333812050460397010231081232865',
            '16974193905075627361661800929777489292323704539192466834819973031357864434540',
          ],
          value: ['0', '0', '0', '0', '0', '0', '1', '705032704'],
          salt: [
            '279714939',
            '2981443327',
            '3559757208',
            '3873893693',
            '994782212',
            '1345563559',
            '467705780',
            '3022085089',
          ],
        },
        {
          pkdRecipient: [
            '7558626710895993898073674364114394751322422716333812050460397010231081232865',
            '16974193905075627361661800929777489292323704539192466834819973031357864434540',
          ],
          value: ['0', '0', '0', '0', '0', '0', '1', '1705032704'],
          salt: [
            '273325760',
            '2579548797',
            '2884837553',
            '1859221534',
            '1132530679',
            '2055150610',
            '1563991769',
            '2864250996',
          ],
        },
      ],
      [
        '12668735466753296745823413933032782706396186298945510537414564855587492263907',
        '1022667382645574792585020477127362420552623525666798122758975284527162365476',
      ],
      [
        [
          '680714268',
          '1574905365',
          '2021544373',
          '528763068',
          '140823776',
          '3193981896',
          '290295535',
          '3225951042',
        ],
        [
          '680714268',
          '1574905365',
          '2021544373',
          '528763068',
          '140823776',
          '3193981896',
          '290295535',
          '3225951042',
        ],
      ],
      [
        '194118974338810599378709417233822144440436870129218025974514759052517287242',
        '332543718483878373437222072998389070432027344617416704947020745346832712706',
      ],
      [
        '12708746732202949224167564367364459907593260627415102275990245937288706716237',
        '18016861735897942613306226895718062561408088411112722023719843645300697499020',
      ],
      [
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '9099494177718611132969532090259439967090162160789474874430926841903203984098',
          '16006392223413218965969204618559813290033806787896183002600957393970265828211',
        ],
        [
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '0',
          '9099494177718611132969532090259439967090162160789474874430926841903203984098',
          '16661896491680466948263856095691422254081917307525316089967276439216412571508',
        ],
      ],
      ['2', '3'],
      {
        ephemeralKey1: [
          '568083298',
          '420622786',
          '2069357924',
          '1480135500',
          '1760994232',
          '2454041763',
          '1348243817',
          '2125810377',
        ],
        ephemeralKey2: [
          '1035699832',
          '231919002',
          '3662726588',
          '2387658320',
          '826836350',
          '1929344427',
          '2975995776',
          '1865054044',
        ],
        ephemeralKey3: [
          '1059298288',
          '1639499931',
          '4126747663',
          '3171591518',
          '170126584',
          '1487746953',
          '3151399618',
          '1120981388',
        ],
        ephemeralKey4: [
          '1736756968',
          '3264907438',
          '4205655436',
          '2632483016',
          '3370552500',
          '3196318055',
          '1719345990',
          '2512336389',
        ],
        cipherText: [
          '5482972956893847118046180905260686787045198249679276526407547697681674979960',
          '16018868930318556003083172473521294065119036380560475244980353937767215305955',
          '17084488619357108961713779552454020079555323563002078747389304657389873382036',
          '20175048239733947619049690093293064341358386849674429753123654953741274165082',
          '9334101000860473154710683894545934825522884271535043263434370069876990595676',
          '21613964795736818090797746742741505586306193426010614348634694224615681495341',
          '244428482492373862231774832013367395473696250474890507617303058920861736122',
          '16521649210226425582133483411056304578038581825414151760986819809368792675583',
          '10706575800579200760078607560929752812730707461565976843082740308945687380655',
          '3702435976187224503324555484844746136528045549498305994201445304210595701389',
          '7637410120141314317430148734857171911034333505559321288740175023878792980517',
          '12665012791440654105383633621109310790966454121260963062546919724229954584565',
          '14863052053160353364480212965131548396139313918241501589342393500538583488208',
          '21131278256459919495505093829168871267906868988311487148729752953239608459857',
          '10372671420614159147093113679989477503553362791581449199496109050527255744162',
          '20276559187255493498785470427984958550107197524061879277142907676159584691734',
        ],
        sqrtMessage1:
          '3235064184807591309652880672332362654741145755388127732110797917184204297979',
        sqrtMessage2: '0',
        sqrtMessage3:
          '2600685551788558350532743378491414594871017866615163182570873935811382354031',
        sqrtMessage4:
          '7890188538787189746608851728137740733149751042931849480229678816876496606295',
      },
      [
        '187919229904232410016826866864744163304780664554929380210762374185342112995',
        '273282902070226530623427044924830179077608235267457808841882702381205008218',
        '355260912323297837251511213802710003869907178803167044515528410662880350509',
        '238386661228835600693813644209567536172490231808447442938097058256008819967',
        '83933187521093396337962203323249016113358528697038367968395803963310400141',
        '253031109195230930557135784070869515049548456526370731246473364456030197',
        '324887221629665630332182460420262825522418618704198297889718326817717977681',
        '374793849591772410359207379616724387826418909654907332861135424799515534870',
      ],
    ];

    const { witness } = zokratesProvider.computeWitness(artifacts, witnessInput);

    // generate proof
    const genProof = zokratesProvider.generateProof(artifacts.program, witness, keypair.pk);
    setProof(JSON.stringify(genProof, 2, 2));
  }, []);

  return (
    <div>
      <span>Double transfer work beigin</span>
      <p>{proof}</p>
    </div>
  );
}
