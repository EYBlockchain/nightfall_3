import React, { useEffect, useState } from 'react';
import { initialize } from 'zokrates-js';

// eslint-disable-next-line
import abi from '../../zokrates/single_transfer/artifacts/single_transfer-abi.json';
// eslint-disable-next-line
import programFile from '../../zokrates/single_transfer/artifacts/single_transfer-program';
// eslint-disable-next-line
import pkFile from '../../zokrates/single_transfer/keypair/single_transfer-pk';
import { parseData, mergeUint8Array } from '../../utils/lib/file-reader-utils';

export default function Zokrates() {
  const [proof, setProof] = useState('');

  useEffect(async () => {
    // oldcommitment
    const ercAddress = [
      '0',
      '0',
      '0',
      '3786913876',
      '4053413099',
      '4184556347',
      '2734706904',
      '2298878123',
    ];
    const id = ['0', '0', '0', '0', '0', '0', '0', '0'];
    const value = ['0', '0', '0', '0', '0', '0', '0', '10'];
    const salt = [
      '3746186814',
      '650786980',
      '1084437808',
      '2163704665',
      '3284490479',
      '3413632784',
      '3416516601',
      '3148413313',
    ];
    const hash = [
      '543006746',
      '3393481281',
      '4073466703',
      '2512373315',
      '3858950242',
      '1055380497',
      '3023087956',
      '1094765179',
    ];
    const ask = '6930558048592459968398874090872446840386493339700763487392344092914357738801';
    const oldCommitment = {
      ercAddress,
      id,
      value,
      salt,
      hash,
      ask,
    };

    // newcommitment
    const pkdRecipient = [
      '11793120019061651548381689667193031350303535754993894421714575842003180702651',
      '19514094396296584559699296843667781122852060401076195850868925920595449006047',
    ];
    const valuenew = ['0', '0', '0', '0', '0', '0', '0', '10'];
    const saltnew = [
      '712034866',
      '866054266',
      '3814000985',
      '4249096863',
      '4065113913',
      '2996438565',
      '3597388231',
      '1667885982',
    ];
    const hashnew = [
      '472587739',
      '1324918119',
      '1807033832',
      '1334073929',
      '3892559028',
      '3845398866',
      '3507663518',
      '2276201717',
    ];
    const newcommitment = {
      pkdRecipient,
      value: valuenew,
      salt: saltnew,
      hash: hashnew,
    };

    // nullifier
    const nsk = [
      '356285367',
      '2834115112',
      '1573131528',
      '2110052527',
      '2559426218',
      '450338363',
      '1256702011',
      '376012475',
    ];
    const hashnullifier = [
      '1891620090',
      '3067515349',
      '1495220547',
      '2170616472',
      '2937727655',
      '4008007523',
      '1761762339',
      '3901356914',
    ];
    const nullifier = { nsk, hash: hashnullifier };

    // path
    const path = [
      '13884572707255978198257443140098116758186701468512178718449225834623576601752',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '0',
      '11552442654508826149654886774876308010229326029958322167680405955306403648395',
      '0',
      '2406218139732324760769007259542356406383940103365588201580317947943448380165',
    ];

    // order
    const order = '4';

    // secrets
    const ephemeralKey1 = [
      '2679237203',
      '3503527839',
      '1388781873',
      '3772344332',
      '129740109',
      '786283164',
      '1610246462',
      '3593074079',
    ];
    const ephemeralKey2 = [
      '1308060774',
      '210384524',
      '2076280842',
      '3189302053',
      '194623319',
      '738150332',
      '3785471981',
      '715206724',
    ];
    const ephemeralKey3 = [
      '1582889066',
      '1356045606',
      '542529867',
      '38588561',
      '3601694477',
      '2368952083',
      '1458183372',
      '2827185879',
    ];
    const ephemeralKey4 = [
      '3606499998',
      '769143815',
      '4024177106',
      '1019751069',
      '2019352040',
      '3701554631',
      '295088779',
      '2423849969',
    ];
    const cipherText = [
      '244277745258585853513141676876204581962698301344585312089712841219917611342',
      '14718330057817658656593893072484481666507121239769701109458885795232098076601',
      '7848280779105096438565732530748032112776011420822973194685231834466034147948',
      '16014765845855805092349861942874862041311104574567060564380184357446867429710',
      '967776976561604534779831131563332803728493108792643274183774772548241082745',
      '11736736055257482275065247682839402645524076651033447215647774825942841169476',
      '9127039525813553201920672988601319025211549133392351392876890764882755314018',
      '21313425638804010327657949532759221852312012653117455775988377529115546808712',
      '16963590291331123591457183928374003930147597080209054478568111747716497606711',
      '20928516370150460885923583115231017143445251657781015873872362680502519403263',
      '3843250319122776724049692413310494126208551676987721252781566536346378594538',
      '10556303176928347134722510059208270780821704289274531778270138450074164327305',
      '20027284826492836292932298755713059268095921474328860019648615878300546814401',
      '19398689963143003492444482068527551002624782403686412620939389763967041058276',
      '15306880169473165615977041875540990915267544865033727181559282318437801589627',
      '5214957194990212213689146012517148467529201725167766518036917059402767882295',
    ];
    const sqrtMessage1 =
      '9427050129567031675553048604712181295465196374683565284398992208923945768094';
    const sqrtMessage2 = '0';
    const sqrtMessage3 =
      '7776112414460028141291788792364523016183925580621199492677386666015993400427';
    const sqrtMessage4 =
      '2220983197769731066101847354068817243110183716854085171716270043156645686319';
    const secrets = {
      ephemeralKey1,
      ephemeralKey2,
      ephemeralKey3,
      ephemeralKey4,
      cipherText,
      sqrtMessage1,
      sqrtMessage2,
      sqrtMessage3,
      sqrtMessage4,
    };
    const zokratesProvider = await initialize();
    const program = await fetch(programFile)
      .then(response => response.body.getReader())
      .then(parseData)
      .then(mergeUint8Array);
    const pk = await fetch(pkFile)
      .then(response => response.body.getReader())
      .then(parseData)
      .then(mergeUint8Array);

    const artifacts = { program: new Uint8Array(program), abi: JSON.stringify(abi) };
    const keypair = { pk: new Uint8Array(pk) };

    // computation
    const { witness } = zokratesProvider.computeWitness(artifacts, [
      oldCommitment,
      newcommitment,
      nullifier,
      path,
      order,
      secrets,
    ]);

    // generate proof
    const genProof = zokratesProvider.generateProof(artifacts.program, witness, keypair.pk);

    setProof(JSON.stringify(genProof, 2, 2));
  }, []);

  return (
    <div>
      <span>Single transfer work beigin</span>
      <p>{proof}</p>
    </div>
  );
}

// ["156503331774401820255184591386897568004066579201585294986195893445927928200","0","0","0","4032733108","2236624474","2476280945","1163966414","1698788291","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","1000000000","172830082","1769496368","1424844534","591842735","972868779","10924732","2883983298","1334285599","84965179","2004732810","3155251002","1597607854","1516159413","2034564382","3961647802","4256608463","19050095353191019700969450004869055325131771711696244913992973653858825392990","607135818944138260287990112473434770207001680477301611406176502210626228896","6203326404641991894455027203313092664539747393780465415363638529404812790512","0","0","0","0","0","0","0","1000000000","386768581","2633472362","118693920","655295559","3194046315","3363489468","538157323","1841807166","64565538","885662027","2773524997","2122214388","2445612214","1778371375","2931029913","2358347306","110986205","1583089169","4034709162","1735821690","4092586133","1053991356","3192463729","790982480","3371813689","3932165885","989315134","2462385038","913499883","82431847","2572043364","3861560539","5357021312349708819682773131077113696732334114590304869953553815226384194026","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","10804741815563719362925741682573583598908725179586888952141654210728278382540",1,"1703115123","2169111002","2362135223","2433716843","3353055895","1556324405","3335012848","969411389","2268171921","1837874099","2228792940","327186590","2451477572","2169411205","1247629272","1686903724","1787404753","3081858380","3356963730","1138485516","628487173","3790287719","1804656220","3149977433","932080551","3080032592","818528893","1939150665","205854490","2101413728","1470316653","387504977","5932538875809536967878391539447459176094171988640073512827833222570963573696","14758860382865265047291935364618619687630117818038019455615577728011801272576","19033482459326184666585603025097556280217289835964355259957045376096930118801","17410861933739334705745768933950160718241547419697799274698418744070296486166","13666274048648975031625360174216307665632274748257874834220236744605498265437","15379529766182562458752044335615540685584317673314091952124453968940249740140","6348915807844714052480072795298905325279223852900364083903624420426614288293","11921737320929153520287567303245146854166314829205102834558280975356672274334","9609618238077344080361331472457347402154940615249006746982808070862175615498","9518118821450808106176472895531526815590473036519992082893229211052016581463","15610329914276112881906304497739033044611925888751079452938900362658595241837","1095969814049087712528160801815980134280782767388783784833957870918594458562","7940817306575566495630298670277092996134557220791025426179925618692202680546","10114753046185290512364650283007226711109837019842462961722336943687587822360","18920124713624296108712139623914860137947812215309544920226334380083100050440","9187061723234873797395438418208732729680352155771794188218328850337830431708","3235064184807591309652880672332362654741145755388127732110797917184204297979","0","2287744532831249441982619566754567414675899488410820637757670451088858932601","10088978652258471168064579789542258645744961827453389914470990296017145090025"]
