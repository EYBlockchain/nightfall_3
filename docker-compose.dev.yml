version: '3.5'
# Use this script for running up nightfall_3 in 'developer' mode with local
# bindings.  See the readme for more information.
services:
  client1:
    build:
      dockerfile: ./core/client/client.Dockerfile
      context: .
    volumes:
      - type: bind
        source: ./core/client/src
        target: /app/src
      - type: bind
        source: ./lib/common-files
        target: /app/lib/common-files
      - type: bind
        source: ./config/default.js
        target: /app/config/default.js

  client2:
    build:
      dockerfile: ./core/client/client.Dockerfile
      context: .
    volumes:
      - type: bind
        source: ./core/client/src
        target: /app/src
      - type: bind
        source: ./lib/common-files
        target: /app/lib/common-files
      - type: bind
        source: ./config/default.js
        target: /app/config/default.js

  worker:
    #  image: 3800decac71d
    build:
      dockerfile: ./core/worker/worker.Dockerfile
      context: .
    volumes:
      - type: bind
        source: ./core/deployer/circuits
        target: /app/circuits/
      - type: bind
        source: ./core/worker/src
        target: /app/src/
      - type: bind
        source: ./config/default.js
        target: /app/config/default.js
  deployer:
    #image: docker.pkg.github.com/eyblockchain/nightfall-deployer/nightfall_deployer:1.1.0

    build:
      dockerfile: core/deployer/deployer.Dockerfile
      context: .
    volumes:
      - type: bind
        source: ./core/deployer/contracts
        target: /app/contracts/
      - type: bind
        source: ./core/deployer/circuits
        target: /app/circuits/
      - type: bind
        source: ./core/deployer/src
        target: /app/src/
      - type: bind
        source: ./lib/common-files
        target: /app/lib/common-files
      - type: bind
        source: ./config/default.js
        target: /app/config/default.js
      - type: bind
        source: ./core/deployer/migrations
        target: /app/migrations
      - type: bind
        source: ./core/deployer/truffle-config.js
        target: /app/truffle-config.js
      - type: bind
        source: ./core/deployer/entrypoint.sh
        target: /app/entrypoint.sh

  optimist1:

    build:
      dockerfile: core/optimist/optimist.Dockerfile
      context: .
    volumes:

      - type: bind
        source: ./core/optimist/src
        target: /app/src
      - type: bind
        source: ./lib/common-files
        target: /app/lib/common-files
      - type: bind
        source: ./config/default.js
        target: /app/config/default.js
  optimist2:

    build:
      dockerfile: core/optimist/optimist.Dockerfile
      context: .
    volumes:

      - type: bind
        source: ./core/optimist/src
        target: /app/src
      - type: bind
        source: ./lib/common-files
        target: /app/lib/common-files
      - type: bind
        source: ./config/default.js
        target: /app/config/default.js
  proposer:
    build:
      dockerfile: ./core/proposer/proposer.Dockerfile
      context: .
    volumes:
      - type: bind
        source: ./core/proposer/src
        target: /app/src
      - type: bind
        source: ./lib/common-files
        target: /app/lib/common-files

      - type: bind
        source: ./config/default.js
        target: /app/config/default.js
